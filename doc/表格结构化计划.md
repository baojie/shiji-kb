# 史记"表"结构化与交互式展示计划

## 项目背景

史记130篇中，"表"（十篇）是最难阅读和理解的部分：
- 采用二维甚至多维表格形式
- 信息密度极高
- 传统纸质/文本形式难以查询和分析
- 现有数字版本多为"（表略）"

**目标**：借鉴程序化和数据可视化方法，让"表"活起来，支持在线浏览、查询、过滤和分析。

---

## 十表概览

| 编号 | 表名 | 时间跨度 | 主要内容 | 优先级 |
|------|------|----------|----------|--------|
| 013 | 三代世表 | 黄帝-共和 | 三代世系关系 | 中 |
| 014 | 十二诸侯年表 | 鲁隐公元年-秦始皇 | 春秋诸侯编年 | 高 |
| 015 | 六国年表 | 秦献公-秦二世 | 战国七雄编年 | 高 |
| 016 | 秦楚之际月表 | 秦二世元年-汉高祖五年 | 秦汉之际月度大事 | **最高** |
| 017 | 汉兴以来诸侯王年表 | 高祖-武帝 | 诸侯王封国变迁 | 高 |
| 018 | 高祖功臣侯者年表 | 高祖-武帝 | 汉初功臣封侯 | **最高** |
| 019 | 惠景间侯者年表 | 惠帝-景帝 | 惠景时期封侯 | 中 |
| 020 | 建元以来侯者年表 | 武帝建元- | 武帝时期封侯 | 中 |
| 021 | 建元已来王子侯者年表 | 武帝建元- | 王子封侯 | 中 |
| 022 | 汉兴以来将相名臣年表 | 高祖-武帝 | 将相任职编年 | **最高** |

**推荐试点顺序**：
1. **016 秦楚之际月表** - 时间短（5年）、事件密集、最具戏剧性
2. **018 高祖功臣侯者年表** - 人物清晰、数据完整、研究价值高
3. **022 汉兴以来将相名臣年表** - 官职变动、政治网络分析

---

## 数据模型设计

### 1. 编年表类（014-017, 022）

**数据结构**：
```json
{
  "table_info": {
    "id": "016_秦楚之际月表",
    "title": "秦楚之际月表",
    "time_range": {
      "start": {"year": -209, "month": 7},
      "end": {"year": -202, "month": 10}
    },
    "dimensions": ["时间", "地域/势力", "人物", "事件"]
  },
  "timeline_data": [
    {
      "date": {"year": -209, "month": 7},
      "entities": {
        "秦": {
          "ruler": "二世皇帝",
          "events": [
            {
              "type": "起义",
              "description": "陈胜、吴广起兵大泽乡",
              "location": "大泽乡",
              "participants": ["陈胜", "吴广"],
              "source_chapter": "006_秦始皇本纪"
            }
          ]
        },
        "陈": {
          "ruler": "陈胜",
          "title": "张楚王",
          "events": ["建立张楚政权"]
        }
      }
    }
  ]
}
```

### 2. 封侯表类（018-021）

**数据结构**：
```json
{
  "table_info": {
    "id": "018_高祖功臣侯者年表",
    "title": "高祖功臣侯者年表"
  },
  "persons": [
    {
      "name": "萧何",
      "title": "酂侯",
      "封地": "酂",
      "户数": 8000,
      "初封时间": {"year": -201},
      "功绩": "镇守关中，供应军粮",
      "身份": "文官",
      "timeline": [
        {"year": -201, "event": "初封酂侯"},
        {"year": -193, "event": "卒"},
        {"year": -193, "successor": "萧禄", "relation": "子"}
      ],
      "source_chapters": ["053_萧相国世家"]
    }
  ]
}
```

### 3. 世系表类（013）

**数据结构**：
```json
{
  "genealogy": {
    "黄帝": {
      "children": ["少昊", "昌意"],
      "spouse": ["嫘祖"],
      "dynasty": "五帝",
      "reign_years": null
    }
  }
}
```

---

## 交互式展示功能

### 核心功能模块

#### 1. 时间轴视图（Timeline View）
```
┌─────────────────────────────────────────────────────┐
│  前209年7月  │  前209年8月  │  前209年9月  │ ...    │
├─────────────────────────────────────────────────────┤
│ 秦 │ 二世    │              │              │        │
│    │ • 陈胜起义│ • 攻占陈    │              │        │
├─────────────────────────────────────────────────────┤
│ 陈 │         │ 陈胜称王     │ 攻占颍川     │        │
└─────────────────────────────────────────────────────┘
```

**功能**：
- ✅ 横向滚动时间轴
- ✅ 多势力并行显示
- ✅ 事件气泡悬停详情
- ✅ 点击跳转到相关章节

#### 2. 人物/封国查询器

**界面**：
```
┌────────────────────────────────────────┐
│ 搜索: [萧何_______________] [🔍]      │
├────────────────────────────────────────┤
│ 筛选:                                   │
│  □ 异姓王  ☑ 功臣侯  □ 王子侯          │
│  封地: [全部 ▼]                        │
│  时期: [━━●━━━━━] 前201年-前180年      │
├────────────────────────────────────────┤
│ 结果: (共137人)                        │
│                                         │
│ 1. 萧何 - 酂侯 (8000户)                │
│    前201年封 | 前193年卒                │
│    [查看详情] [关系图] [时间线]        │
│                                         │
│ 2. 曹参 - 平阳侯 (10600户)             │
│    ...                                  │
└────────────────────────────────────────┘
```

#### 3. 统计分析面板

**可视化图表**：
- 📊 **封侯人数分布**：按时期、功绩类型、出身分布
- 🗺️ **地理分布图**：封国在地图上的位置
- 📈 **存续时长分析**：爵位传承代数统计
- 🕸️ **关系网络图**：同时期功臣关系网

#### 4. 数据导出

支持格式：
- CSV - Excel导入分析
- JSON - 程序化处理
- SQL - 数据库导入
- Markdown Table - 文档引用

---

## 技术实现方案

### 前端技术栈

```javascript
// 核心库
- D3.js - 时间轴、网络图可视化
- DataTables - 表格排序、过滤
- Leaflet - 地理地图展示
- Chart.js - 统计图表

// 示例代码结构
const TableViewer = {
  data: null,  // 表格JSON数据

  init(tableId) {
    this.loadData(tableId);
    this.renderTimeline();
    this.setupFilters();
  },

  filter(criteria) {
    // 按人物、时间、地点筛选
  },

  export(format) {
    // 导出CSV/JSON
  },

  linkToChapter(entityName) {
    // 跳转到相关章节
  }
};
```

### 数据处理脚本

```python
# tables/scripts/parse_table_data.py
"""
从原始文本/数据库提取表格数据，转换为JSON
"""

def extract_timeline_table(chapter_id):
    """提取编年表数据"""
    data = {
        "table_info": {...},
        "timeline_data": []
    }
    # 解析逻辑
    return data

def extract_peerage_table(chapter_id):
    """提取封侯表数据"""
    # ...
```

---

## 数据来源策略

### 优先级方案

#### 方案A：手工结构化（推荐试点）
- **范围**：先做1-2个最重要的表（016、018）
- **方法**：从中华书局标点本人工录入
- **周期**：2-4周/表
- **优点**：质量可控、可边做边优化模型

#### 方案B：利用现有数据库
- **CBDB（中国历代人物传记数据库）**：
  - 已有部分功臣、将相数据
  - 可直接转换为JSON
  - 需要数据清洗和对齐

- **ctext API**：
  - 可能有部分表格数据
  - 需验证数据完整性

#### 方案C：OCR + AI 辅助
- 扫描中华书局版
- 使用Claude辅助结构化
- 人工校验

---

## 实施路线图

### Phase 1: MVP原型（4-6周）

**目标**：完成1个表的完整流程验证

1. **选定表格**：016_秦楚之际月表
   - 时间短（5年）
   - 事件清晰
   - 最具吸引力

2. **数据录入**：
   - 手工录入JSON数据（约200-300条记录）
   - 建立数据模板

3. **交互界面**：
   - 基础时间轴视图
   - 简单筛选功能
   - 链接到相关章节

4. **部署展示**：
   - 集成到GitHub Pages
   - 从主页链接

### Phase 2: 扩展3-5个表（2-3个月）

**目标表格**：
- 018_高祖功臣侯者年表
- 022_汉兴以来将相名臣年表
- 015_六国年表

**新增功能**：
- 统计分析面板
- 数据导出功能
- 地理地图展示
- 关系网络图

### Phase 3: 完整10表 + 高级分析（3-6个月）

- 完成全部10个表
- 跨表查询（"萧何在哪些表中出现？"）
- Neo4j图数据库整合
- 智能问答功能

---

## 预期成果

### 学术价值
- ✅ 提供可查询、可分析的史记表格数据集
- ✅ 支持量化历史研究（封侯模式、权力网络等）
- ✅ 跨表关联分析（人物在不同表中的轨迹）

### 技术价值
- ✅ 验证AI Agent驱动的古籍结构化方法
- ✅ 建立表格类历史文献数字化标准
- ✅ 为26史其他表格数字化提供模板

### 用户价值
- ✅ 降低阅读"表"的门槛
- ✅ 提供现代化的数据探索体验
- ✅ 支持研究者快速查询和分析

---

## 资源需求

### 数据采集
- 中华书局《史记》标点本（实体书或PDF）
- CBDB等数据库访问权限（可选）

### 开发工具
- 继续使用Claude Code + AI Agent方法
- D3.js、DataTables等前端库（开源免费）

### 时间投入
- Phase 1 MVP：4-6周
- Phase 2 扩展：2-3个月
- Phase 3 完整：累计6-9个月

---

## 与现有项目整合

在README.md"扩展计划"中添加：

```markdown
### 近期目标：知识图谱深化

#### 3. 表格结构化（Tables Structuring）

让史记最难读的"表"活起来：

- **数据结构化**：将10个表转换为可查询的JSON数据
- **交互式展示**：时间轴、筛选器、统计图表
- **深度链接**：表格数据与本纪/世家/列传互相链接
- **典型案例**：秦楚之际月表、高祖功臣侯者年表

**技术特点**：
- 借鉴程序化方法构造交互式阅读器
- 支持在线浏览、查询、过滤
- 数据可导出、可分析
```

---

## 下一步行动

### 立即可做
1. ✅ 创建 `tables/` 目录结构
2. ✅ 准备016秦楚之际月表数据录入模板
3. ✅ 设计表格查看器HTML原型

### 需要决策
- [ ] 是否购买/获取中华书局版《史记》数据
- [ ] 选择哪1-2个表作为MVP试点
- [ ] 是否尝试利用CBDB现有数据

---

**文档创建时间**：2026-02-08
**最后更新**：2026-02-08
**状态**：计划阶段
